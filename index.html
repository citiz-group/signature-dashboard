<!DOCTYPE html>

<html class="h-100"
      lang="en"
      dir="ltr">

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <meta charset="utf-8">
</head>

<body>
  <table class="table" id="signatures">
    <tr>
      <th>Date ⬇️</th>
      <th>Type</th>
      <th>Client</th>
      <th>Conseiller</th>
      <th>Statut</th>
    </tr>
  </table>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const SIGNATURES = [];

    fetch('https://hook.eu1.make.com/9n9hxqyeklz97u99n7hfbrt1b7nadhq8')
      .then(response => response.json())
      .then(response => {
        response.forEach(element => {
          const TYPE = String(element.emailSubject).split(' ')[0] + ' ' + String(element.emailSubject).split(' ')[1] + ' ' + String(element.emailSubject).split(' ')[2];
          SIGNATURES.push({
            advisorEmail: String(element.emailBlurb).split('\n')[3],
            advisorName: String(element.emailBlurb).split('\n')[2] ? String(element.emailBlurb).split('\n')[2].replace('Conseiller: ', '') : '',
            clientEmail: String(element.emailBlurb).split('\n')[1],
            clientName: String(element.emailBlurb).split('\n')[0] ? String(element.emailBlurb).split('\n')[0].replace('Client: ', '') : '',
            dateTime: element.statusChangedDateTime,
            status: element.status,
            type: TYPE.replace('Immocitiz', '')
          });
        });

        let temp = '';
        SIGNATURES.sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime)).forEach(element => {
          switch (element.status) {
            case 'completed':
              temp += '<tr class="table-success">';
              break;
            case 'declined':
              temp += '<tr class="table-danger">';
              break;
            case 'sent':
              temp += '<tr class="table-warning">';
              break;
            case 'voided':
              temp += '<tr>';
              break;
          }
          temp +=
            '<td>' + new Date(element.dateTime).toLocaleDateString('fr-FR') + ' ' + new Date(element.dateTime).toLocaleTimeString('fr-FR') + '</td>' +
            '<td>' + String(element.type).trim() + '</td>' +
            '<td>' + String(element.clientName).trim() + ' (' + String(element.clientEmail).trim() + ')</td>' +
            '<td>' + String(element.advisorName).trim() + ' (' + String(element.advisorEmail).trim() + ')</td>';
          switch (element.status) {
            case 'completed':
              temp += '<td>Complétée</td>';
              break;
            case 'declined':
              temp += '<td>Déclinée</td>';
              break;
            case 'sent':
              temp += '<td>Envoyée</td>';
              break;
            case 'voided':
              temp += '<td>Annulée</td>';
              break;
          }
        });
        document.getElementById('signatures').innerHTML += temp + '</tr>';
      })
  </script>
</body>

</html>
