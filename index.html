<!DOCTYPE html>

<html class="h-100"
      lang="en"
      dir="ltr">

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <meta charset="utf-8">
</head>

<body class="d-flex align-items-center flex-column p-3 w-100" style="background-color: #eee;">
  <table class="table" id="signatures" style="width: 100%;">
    <tr>
      <th style="width: calc(100% / 6);">Date</th>
      <th style="width: calc(100% / 6);">Nom client</th>
      <th style="width: calc(100% / 6);">Email client</th>
      <th style="width: calc(100% / 6);">Nom conseiller</th>
      <th style="width: calc(100% / 6);">Email conseiller</th>
      <th style="width: calc(100% / 6);">Statut</th>
    </tr>
  </table>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const SIGNATURES = [];

    fetch('https://hook.eu1.make.com/9n9hxqyeklz97u99n7hfbrt1b7nadhq8')
      .then(response => response.json())
      .then(response => {
        response.forEach(element => {
          SIGNATURES.push({
            advisorEmail: String(element.emailBlurb).split('\n')[3],
            advisorName: String(element.emailBlurb).split('\n')[2] ? String(element.emailBlurb).split('\n')[2].replace('Conseiller: ', '') : '',
            clientEmail: String(element.emailBlurb).split('\n')[1],
            clientName: String(element.emailBlurb).split('\n')[0] ? String(element.emailBlurb).split('\n')[0].replace('Client: ', '') : '',
            dateTime: element.statusChangedDateTime,
            status: element.status
          });
        });

        let temp = '';
        SIGNATURES.sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime)).forEach(element => {
          temp +=
            '<tr>' +
              '<td>' + new Date(element.dateTime).toLocaleDateString('fr-FR') + ' ' + new Date(element.dateTime).toLocaleTimeString('fr-FR') + '</td>' +
              '<td>' + element.clientName + '</td>' +
              '<td>' + element.clientEmail + '</td>' +
              '<td>' + element.advisorName + '</td>' +
              '<td>' + element.advisorEmail + '</td>';
          switch (element.status) {
            case 'completed':
              temp += '<td>Complétée</td>';
              break;
            case 'declined':
              temp += '<td>Déclinée</td>';
              break;
            case 'sent':
              temp += '<td>Envoyée</td>';
              break;
            case 'voided':
              temp += '<td>Annulée</td>';
              break;
          }
        });
        document.getElementById('signatures').innerHTML += temp + '</tr>';
      })
  </script>
</body>

</html>
